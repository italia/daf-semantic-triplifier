@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix clvapit: <http://w3id.org/italia/onto/CLV/>.

# http://dati.gov.it/Resource/City/Abano_Terme
# http://dati.gov.it/Resource/Region/Basilicata

@base  <test://prova/> .

<VIEW_comuni> rr:sqlQuery """
		
	SELECT 
		ANPR.denominazione_it,
		LOWER(REPLACE(ANPR.denominazione_it, " ", "_")) AS "_ID_COMUNE",
		ISTAT.codice_comune_formato_alfanumerico AS "_alfa",
		ISTAT.denominazione_regione,
		LOWER(REPLACE(ISTAT.denominazione_regione, " ", "_")) AS "_ID_REGIONE",
		LOWER(REPLACE(ISTAT.denominazione_provincia, " ", "_")) AS "_ID_PROVINCIA",
		LOWER(REPLACE(ISTAT.denominazione_citta_metropolitana, " ", "_")) AS "_ID_CITTA_METROPOLITANA",
		SUBSTR(ANPR.dataistituzione,7)||'/'||substr(ANPR.dataistituzione,4,2)||'/'||substr(ANPR.dataistituzione,1,2) AS "_DATA_START",
		SUBSTR(ANPR.datacessazione,7)||'/'||substr(ANPR.datacessazione,4,2)||'/'||substr(ANPR.datacessazione,1,2) AS "_DATA_STOP"
		
	FROM 'gove__amministrazione.default_org_o_anpr_archivio_storico_comuni' AS ANPR 
	JOIN 'gove__amministrazione.default_org_o_istat_elenco_comuni_italiani' AS ISTAT
	ON (ANPR.codistat=ISTAT.codice_comune_formato_alfanumerico)
	
	-- LIMIT 100 OFFSET 333
	
	/*
	CAPITALIZATION EXAMPLE! 
	UPPER(SUBSTR(ANPR.denominazione_it, 1, 1))||SUBSTR(LOWER(ANPR.denominazione_it), 2) AS "_altro"
	*/
		 
"""
.

<TriplesMap_City> a rr:TriplesMapClass ;
	
	rr:logicalTable <VIEW_comuni> ;
	
	rr:subjectMap [ 
		rr:template "http://w3id.org/italia/resources/cities/{_DATA_START}/{'_ID_COMUNE'}" ;
		# TODO rr:class clvapit:Feature, clvapit:AddressComponent, clvapit:NamedAddressComponent, clvapit:City ;
		rr:class clvapit:City ;
	] ;
	
	rr:predicateObjectMap [ 
	  rr:predicate clvapit:name ; 
	  rr:objectMap [ rr:column "ANPR.denominazione_it" ; rr:language "it" ]
	] ;
	
	rr:predicateObjectMap [ 
	  rr:predicate clvapit:situatedWithin ; 
	  rr:objectMap [ rr:template "http://w3id.org/italia/resources/provinces/{'_ID_PROVINCIA'}"  ]
	] ;
	
	rr:predicateObjectMap [ 
	  rr:predicate clvapit:start_date ; 
	  rr:objectMap [ rr:column "_DATA_START" ; rr:datatype xsd:string ]
	] ;
	    
 .
 
<TriplesMap_Province> a rr:TriplesMapClass ;
	
	rr:logicalTable <VIEW_comuni> ;
	
	rr:subjectMap [ 
		rr:template "http://w3id.org/italia/resources/provinces/{'_ID_PROVINCIA'}" ;
		# TODO rr:class clvapit:Feature, clvapit:AddressComponent, clvapit:NamedAddressComponent, clvapit:City ;
		rr:class clvapit:Province ;
	] ;
	
	rr:predicateObjectMap [ 
	  rr:predicate clvapit:situatedWithin ; 
	  rr:objectMap [ rr:template "http://w3id.org/italia/resources/regions/{_ID_REGIONE}" ];
	] ;
		
 .
 
 
<TriplesMap_Region> a rr:TriplesMapClass ;
	
	rr:logicalTable <VIEW_comuni> ;
	
	rr:subjectMap [ 
		rr:template "http://w3id.org/italia/resources/regions/{'_ID_REGIONE'}" ;
		# TODO rr:class clvapit:Feature, clvapit:AddressComponent, clvapit:NamedAddressComponent, clvapit:City ;
		rr:class clvapit:Region ;
	] ;
	
	rr:predicateObjectMap [ 
	  rr:predicate clvapit:name ; 
	  rr:objectMap [ rr:column "ISTAT.denominazione_regione" ; rr:language "it" ]
	] ;

	rr:predicateObjectMap [ 
	  rr:predicate clvapit:situatedWithin ; 
	  rr:objectMap [ rr:constant <http://w3id.org/italia/resources/countries/ITA> ] 
	] ;
		
 .






















[] rdfs:comment """

TODO 
clvapit:hasIdentifier   <http://dati.gov.it/Resource/Identifier/regione_8> ;



<TriplesMap_CittaMetropolitane> a rr:TriplesMapClass ;
	
	rr:logicalTable <VIEW_comuni> ;
	
	rr:subjectMap [ 
		rr:template "http://w3id.org/italia/resources/provinces/{'_ID_CITTA_METROPOLITANA'}" ;
		# TODO rr:class clvapit:Feature, clvapit:AddressComponent, clvapit:NamedAddressComponent, clvapit:City ;
		rr:class clvapit:Province, clvapit:City ;
	] ;
	
	rr:predicateObjectMap [ 
	  rr:predicate clvapit:situatedWithin ; 
	  rr:objectMap [ rr:template "http://w3id.org/italia/resources/regions/{_ID_REGIONE}" ];
	] ;
		
 .
 
NUTS 0: countries
NUTS 1: major socio-economic regions
NUTS 2: basic regions for the application of regional policies
NUTS 3: as small regions for specific diagnoses
 

"""
 
 .