TODO: review the examples, refactorize into tests